(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{469:function(t,s,e){"use strict";e.r(s);var a=e(51),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"slurm的内置环境变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#slurm的内置环境变量"}},[t._v("#")]),t._v(" slurm的内置环境变量")]),t._v(" "),e("h2",{attrs:{id:"常用内置变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用内置变量"}},[t._v("#")]),t._v(" 常用内置变量")]),t._v(" "),e("p",[t._v("通过"),e("code",[t._v("slurm")]),t._v("作业调度系统提交的任务，会分配一个"),e("code",[t._v("jobid")]),t._v("号，与这个任务相关的SLURM环境变量，可以通过以"),e("code",[t._v("SLURM_*")]),t._v("开头的一些内置变量进行查看和使用。")]),t._v(" "),e("p",[t._v("常用内置变量如下：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("变量名")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("含义")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_JOB_NAME")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("任务名")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("默认为提交时的脚本名, 可以用"),e("code",[t._v("-J")]),t._v("参数进行设置")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("SLURM_NNODES")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("分配的节点数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("常用，与"),e("code",[t._v("-N")]),t._v("参数含义相同")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_JOBID")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("分配的任务编号")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("SLURM_NTASKS")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("分配的task数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_TASKS_PER_NODE")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("每个节点分配的task数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_JOB_ID")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("分配的任务编号")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_SUBMIT_DIR")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("提交作业时的工作目录")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("SLURM_NPROCS")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("加载的进程数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("常用，与"),e("code",[t._v("-n")]),t._v("参数含义相同")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_CPUS_ON_NODE")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("节点的CPU核心数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("SLURM_JOB_NODELIST")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("任务的节点列表")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("常用，使用"),e("code",[t._v("yhq")]),t._v("命令查询到的节点列表")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_JOB_CPUS_PER_NODE")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("每个节点的CPU核心数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_SUBMIT_HOST")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("提交任务的节点名")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("通常为某个登录节点，如"),e("code",[t._v("ln2")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("SLURM_JOB_NUM_NODES")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("节点的任务数量")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),e("p",[t._v("我们可以尝试编写一个脚本文件"),e("code",[t._v("slurm-env.sh")]),t._v("来测试一下看看：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOB_NAME")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NNODES")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOBID")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NTASKS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_TASKS_PER_NODE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOB_ID")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_SUBMIT_DIR")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NPROCS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_CPUS_ON_NODE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOB_NODELIST")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOB_CPUS_PER_NODE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_SUBMIT_HOST")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_JOB_NUM_NODES")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br")])]),e("p",[t._v("然后使用 "),e("code",[t._v("yhbatch")]),t._v(" 命令提交任务：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("yhbatch -N "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" -n "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" -p debug slurm-env.sh\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("然后检查 slurm-jobid.out 文件，应该与下方内容相似：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("SLURM_JOB_NAME=slurm-env.sh\nSLURM_NNODES=2\nSLURM_JOBID=17603587\nSLURM_NTASKS=4\nSLURM_TASKS_PER_NODE=2(x2)\nSLURM_JOB_ID=17603587\nSLURM_SUBMIT_DIR=/vol-th/home/zhenggang/workdir/slurm\nSLURM_NPROCS=4\nSLURM_CPUS_ON_NODE=12\nSLURM_JOB_NODELIST=cn[13-14]\nSLURM_JOB_CPUS_PER_NODE=12(x2)\nSLURM_SUBMIT_HOST=ln3\nSLURM_JOB_NUM_NODES=2\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("p",[t._v("这样，我们就可以在任务脚本中直接使用这些内置变量进行相关操作了。")]),t._v(" "),e("h2",{attrs:{id:"使用yhcontrol获得节点列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用yhcontrol获得节点列表"}},[t._v("#")]),t._v(" 使用yhcontrol获得节点列表")]),t._v(" "),e("p",[t._v("默认使用"),e("code",[t._v("yhrun")]),t._v("命令运行程序时，用户并不需要关心所使用的节点编号。")]),t._v(" "),e("p",[t._v("当用户需要节点编号，或者使用如"),e("code",[t._v("mpirun")]),t._v("等命令需要配置如"),e("code",[t._v("hostfile")]),t._v("文件时，可以在编写的脚本中，使用相关命令生成节点编号文件，进而使用。举例如下：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# get hostname list ")]),t._v("\nyhcontrol show "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NODELIST")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SLURM_NODEFILE\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# run job")]),t._v("\nmpirun -np "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NPROCS")]),t._v(" -machinefile SLURM_NODEFILE "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EXEC")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("说明：")]),t._v(" "),e("ol",[e("li",[t._v("第一行："),e("code",[t._v("yhcontrol show hostnames $SLURM_NODELIST")]),t._v(" 是将 "),e("code",[t._v("SLURM_NODELIST")]),t._v(" 变量中的节点名展开显示， "),e("code",[t._v("sort")]),t._v(" 命令是进行排序， "),e("code",[t._v("> SLURM_NODEFILE")]),t._v(" 用于定向输出到 SLURM_NODEFILE 文件中")]),t._v(" "),e("li",[t._v("第二行："),e("code",[t._v("mpirun")]),t._v("命令运行，使用"),e("code",[t._v("-np $SLURM_NPROCS")]),t._v(" 个进程，指明"),e("code",[t._v("-machinefile SLURM_NODEFILE")]),t._v(" 文件为节点信息文件")])]),t._v(" "),e("p",[t._v("这样就可以自动获得节点编号配置文件，并设置给"),e("code",[t._v("mpirun")]),t._v("命令使用了。")]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),e("p",[t._v("我们发现：SLURM_NODELIST 变量在 "),e("code",[t._v("csh")]),t._v(" 环境下未定义，因此下面给出另一种方法，适用于各种 shell 环境")])]),t._v(" "),e("h2",{attrs:{id:"使用yhrun获得节点列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用yhrun获得节点列表"}},[t._v("#")]),t._v(" 使用yhrun获得节点列表")]),t._v(" "),e("p",[t._v("有用户反映，在"),e("code",[t._v("csh")]),t._v("下，"),e("code",[t._v("yhcontrol")]),t._v(" 命令无法正确获得节点列表，我们可以使用"),e("code",[t._v("yhrun")]),t._v("命令获得。")]),t._v(" "),e("p",[t._v("例如：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# get hostname list ")]),t._v("\nyhrun -N "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NNODES")]),t._v(" -n "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NNODES")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SLURM_NODEFILE\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# run job")]),t._v("\nmpirun -np "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SLURM_NPROCS")]),t._v(" -machinefile SLURM_NODEFILE "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EXEC")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("说明：")]),t._v(" "),e("ol",[e("li",[t._v("第一行：使用"),e("code",[t._v("yhrun")]),t._v("命令并行执行"),e("code",[t._v("hostname")]),t._v("命令，会显示各个节点的主机名，进行排序后，定向输出到 SLURM_NODEFILE 文件中即可")]),t._v(" "),e("li",[t._v("第二行：与"),e("code",[t._v("yhcontrol")]),t._v("方法相同（见上一节）")])])])}),[],!1,null,null,null);s.default=n.exports}}]);