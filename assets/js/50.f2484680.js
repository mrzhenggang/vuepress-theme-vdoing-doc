(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{444:function(s,a,t){"use strict";t.r(a);var n=t(51),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"co-array-fortran"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#co-array-fortran"}},[s._v("#")]),s._v(" Co-Array Fortran")]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("Co-Array Fortran（下面简称 CAF，中文暂称为”Fortran的集合数组阵列扩展“），最初是作为 Fortran 95 一个小小的扩展，由 Numrich 和 Reid 发表于 1998年 ACM Fortran Forum 17卷第2期的 “Co-Array Fortran for Parallel Programming” 文章中。 直到 2005 年的5月，国际标准组织 Fortran 委员会决定将 CAF 包含在下一版本的 Fortran 语言规范草案中 (也就是今天我们常说的 Fortran 2008).")]),s._v(" "),t("p",[s._v("它提供了一种非常简洁、直观的标注方法，来处理那些通常必须要通过消息传递（message-passing）模型来处理的数据分解问题；同时它本身使用的是自然的，类似于 Fortran 的语法。 这种语法独立于硬件架构，可以在分布式内存系统，共享内存系统和集群系统等中得到使用。")]),s._v(" "),t("p",[s._v("由于Coarrays是语言标准的一部分，避免了用户直接使用类似MPI对通讯库的访问，简化了进程间变量交换的编程。 并且语言标准提供了内在的同步功能（Synchronization），使竞态（Race Condition， RC）和死锁（Deadlock）得以避免。")]),s._v(" "),t("h2",{attrs:{id:"共享内存简单示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#共享内存简单示例"}},[s._v("#")]),s._v(" 共享内存简单示例")]),s._v(" "),t("h3",{attrs:{id:"使用coarray写源程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用coarray写源程序"}},[s._v("#")]),s._v(" 使用coarray写源程序")]),s._v(" "),t("p",[s._v("我们以GNU官方提供的Hello_World 为例简单介绍如何使用它。")]),s._v(" "),t("p",[s._v("网址为："),t("a",{attrs:{href:"https://gcc.gnu.org/wiki/CoarrayExample",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gcc.gnu.org/wiki/CoarrayExample"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("源码文件："),t("code",[s._v("Hello_World.f90")]),s._v("，内容如下：")]),s._v(" "),t("div",{staticClass:"language-fortran line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-fortran"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! Created by Tobias Burnus 2010.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("program")]),s._v(" Hello_World\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implicit none")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("integer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v(" i  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! Local variable")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("character")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("len"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v(" name["),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("] "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! scalar coarray")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('! Note: "name" is the local variable while "name[<index>]"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! accesses the variable on a remote image")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! Interact with the user on Image 1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("this_image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(a)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("advance"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'no'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Enter your name: '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(a)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" name\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! Distribute information to other images")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" num_images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      name[i] "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end do")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end if")]),s._v("\n\n  sync all "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! Barrier to make sure the data has arrived")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("! I/O from all nodes")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(3a,i0)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' from image '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" this_image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end program")]),s._v(" Hello_world\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h3",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[s._v("#")]),s._v(" 编译")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用module命令加载编译环境")]),s._v("\nmodule "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" Intel_compiler/18.0.4\nmodule "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" MPI/Intel/IMPI/2018.4.274\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译")]),s._v("\nifort -coarray HelloWorld.f90  -o  HelloWorld.out\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ifort")]),s._v("为编译器名称")]),s._v(" "),t("li",[t("code",[s._v("-coarray")]),s._v(" 为需要开启的编译器选项")]),s._v(" "),t("li",[s._v("加载"),t("code",[s._v("MPI/Intel/IMPI/2018.4.274")]),s._v(" 是因为，我们需要在编译过程中的链接阶段使用"),t("code",[s._v("libicaf.so")]),s._v("库，它需要MPI支持。")])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("你的编译器加载方式与示例很可能不同，请参考自己环境的用户手册，加载自己的编译器。")])]),s._v(" "),t("h3",{attrs:{id:"运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接执行")]),s._v("\n./HelloWorld.out\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入姓名, 例如 zhenggang")]),s._v("\nzhenggang\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 屏幕显示")]),s._v("\n$ ./Hello_World.out\nEnter your name: zhenggang\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nHello zhenggang from image "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("以上方式编译后，通过测试发现，应该只支持共享内存式的运行，并且自动获得"),t("code",[s._v("num_image")]),s._v("并行数。当我们需要灵活配置，并跨节点使用时，需要在编译和运行阶段进行更多配置，请继续阅读。")])]),s._v(" "),t("h2",{attrs:{id:"分布式内存复杂示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式内存复杂示例"}},[s._v("#")]),s._v(" 分布式内存复杂示例")]),s._v(" "),t("h3",{attrs:{id:"使用coarray写源程序-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用coarray写源程序-2"}},[s._v("#")]),s._v(" 使用coarray写源程序")]),s._v(" "),t("p",[s._v("我们编写一个fortran程序"),t("code",[s._v("term.f90")]),s._v("如下：")]),s._v(" "),t("div",{staticClass:"language-fortran line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-fortran"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("program")]),s._v(" term\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implicit none")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("integer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v(" i["),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("]"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("real")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v(" r\nimg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" this_image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" img\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" img"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("eq. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"img cannot continue"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000000")]),s._v("\n r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" atan"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("real")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end do")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"img"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"编译-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译-2"}},[s._v("#")]),s._v(" 编译")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用module命令加载编译环境")]),s._v("\nmodule "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" Intel_compiler/18.0.4\nmodule "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" MPI/Intel/IMPI/2018.4.274\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译")]),s._v("\nifort -coarray"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("distributed -coarray-config-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cafconfig.txt term.f90 -o term.x\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-coarray=distributed")]),s._v(" ：指明为分布式内存方式")]),s._v(" "),t("li",[t("code",[s._v("-coarray-config-file=cafconfig.txt")]),s._v("：指明当前目录有一个名为"),t("code",[s._v("cafconfig.txt")]),s._v("的配置文件。这个配置信息将会被写入可执行程序"),t("code",[s._v("term.x")]),s._v("中。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("对于参数"),t("code",[s._v("-coarray-config-file=cafconfig.txt")]),s._v("，你可以指定任何其他相对/绝对路径，但是一会儿运行的时候，要提供给可执行程序。因此，此处直接写名称，默认就在当前目录查找了。")])]),s._v(" "),t("h3",{attrs:{id:"运行-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-2"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),t("h4",{attrs:{id:"本地运行-仅测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地运行-仅测试"}},[s._v("#")]),s._v(" 本地运行（仅测试）")]),s._v(" "),t("p",[t("strong",[s._v("直接运行报错")])]),s._v(" "),t("p",[s._v("这次，我们先尝试直接运行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./term.x\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("报错了，报错内容类似：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./term.x\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mpiexec@ln0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" HYDU_parse_hostfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/utils/args/args.c:553"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n\tunable to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" file: cafconfig.txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mpiexec@tln0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" config_tune_fn "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/ui/mpich/utils.c:2195"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n\terror parsing config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mpiexec@ln0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" match_arg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/utils/args/args.c:243"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n\tmatch handler returned error\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mpiexec@ln0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" HYDU_parse_array_single "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/utils/args/args.c:294"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n\targument matching returned error\n\nUsage: ./mpiexec "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("exec1 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" \n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("exec2 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nGlobal options "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("passed to all executables"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n\n  Global environment options:\n    -genv "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("       environment variable name and value\n    -genvlist "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env1,env2,"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  environment variable list to pass\n    -genvnone                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not pass any environment variables\n    -genvall                   pass all environment variables not managed\n                                    by the launcher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("这是因为，我们将可执行程序编译为一个分布式内存的程序，需要使用"),t("code",[s._v("mpiexec")]),s._v("或类似的并行命令去执行。")]),s._v(" "),t("p",[t("strong",[s._v("编写hostsfile")])]),s._v(" "),t("p",[s._v("我们先写"),t("code",[s._v("手写")]),s._v("一个名为"),t("code",[s._v("hostsfile")]),s._v("的文件，里面写上当前节点的主机名，以及核数，类似：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ln0:40\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ln0")]),s._v("：可以使用"),t("code",[s._v("hostname")]),s._v("命令可以获得当前节点的主机名")]),s._v(" "),t("li",[t("code",[s._v(":40")]),s._v("：可以使用"),t("code",[s._v('cat /proc/cpuinfo| grep "processor"| wc -l')]),s._v("命令获得当前节点核数")])]),s._v(" "),t("p",[t("strong",[s._v("编写cafconfig.txt")])]),s._v(" "),t("p",[s._v("我们先把刚才的"),t("code",[s._v("cafconfig.txt")]),s._v("文件写一下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("-genvall -genv "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("I_MPI_FABRICS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shm:tcp -machinefile ./hostsfile -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" ./term.x\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参数说明：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-genvall")]),s._v("：从当前 shell 继承环境变量设置")]),s._v(" "),t("li",[t("code",[s._v("-genv I_MPI_FABRICS=shm:tcp")]),s._v("：选择要按优先级顺序使用的交换矩阵：在节点内使用共享内存shm，TCP 用于远程")]),s._v(" "),t("li",[t("code",[s._v("-machinefile ./hostsfile")]),s._v("：表示要查找要运行的群集节点列表")]),s._v(" "),t("li",[t("code",[s._v("-n 4")]),s._v("：运行4个CAF的images，就是4个核跑一下")]),s._v(" "),t("li",[t("code",[s._v("./term.x")]),s._v("：可执行程序的路径和名称，"),t("code",[s._v("./")]),s._v("表示当前目录")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("建议")]),s._v(" "),t("p",[s._v("当集群支持除tcp以外的高速网络是，推荐使用高速网络，例如ib网络，配置参数例如：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-genv I_MPI_FIBRIC=sch:ofa")]),s._v(" //节点内shm，节点外ofa")]),s._v(" "),t("li",[t("code",[s._v("-genv I_MPI_FIBRIC=ofa")]),s._v("//节点内外均为ofa")])])]),s._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[s._v("补充")]),s._v(" "),t("p",[s._v("补充内容，通讯结构如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("结构")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("介绍")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("shm")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Shared memory transport (used for intra-node)")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("ofi")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("OpenFabrics Interfaces "),t("em",[s._v("(OFI)-capable network fabrics, such as Intel® True Scale Fabric, Intel® Omni-Path Architecture, InfiniBand")]),s._v(", and Ethernet (through OFI API).")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("dapl")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Direct Access Programming Library* (DAPL)-capable network fabrics, such as InfiniBand* and iWarp* (through DAPL).")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("tcp")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("TCP/IP-capable network fabrics, such as Ethernet and InfiniBand* (through IPoIB*).")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("tmi")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Tag Matching Interface (TMI)-capable network fabrics, such as Intel® True Scale Fabric, Intel® Omni-Path Architecture and Myrinet* (through TMI).")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("ofa")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("OpenFabrics Alliance "),t("em",[s._v("(OFA)-capable network fabrics, such as InfiniBand")]),s._v(" (through OFED* verbs).")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("ofi")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("OpenFabrics Interfaces* (OFI)-capable network fabrics, such as Intel® True Scale Fabric, Intel® Omni-Path Architecture, InfiniBand* and Ethernet (through OFI API).")])])])]),s._v(" "),t("p",[s._v("通讯结构由变量 "),t("code",[s._v("I_MPI_FIBRIC")]),s._v(" 控制，默认的行为：使用共享内存，并从结构表中选择最前面且可用的结构方式，结构表一般为（dapl,ofa,tcp,tmi,ofi），也可以看I_MPI_FABRICS_LIST。")])]),s._v(" "),t("p",[t("strong",[s._v("运行")])]),s._v(" "),t("p",[s._v("将这个"),t("code",[s._v("cafconfig.txt")]),s._v("文件和可执行程序放在统一目录，并执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./term.x\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这次就会运行并获得正确输出：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("img cannot "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("对于集群计算节点，每次运行的节点名和核数会变化，在分配资源前并不能确定节点名。因此我们尝试通过脚本方式自动生成 "),t("code",[s._v("hostsfile")]),s._v(" 文件和 "),t("code",[s._v("cafconfig.txt")]),s._v(" 文件，实现动态化。")])]),s._v(" "),t("h4",{attrs:{id:"提交运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提交运行"}},[s._v("#")]),s._v(" 提交运行")]),s._v(" "),t("p",[s._v("我们以"),t("code",[s._v("SLURM")]),s._v("作业调度系统为例，编写自动获取节点信息、自动生成 "),t("code",[s._v("hostsfile")]),s._v(" 文件和 "),t("code",[s._v("cafconfig.txt")]),s._v(" 文件的脚本，实现支持"),t("code",[s._v("CAF")]),s._v("的作业提交。")]),s._v(" "),t("p",[t("strong",[s._v("编写提交脚本"),t("code",[s._v("sub.sh")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SBATCH -N 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SBATCH -n 56")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SBATCH -p debug")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# change executable program name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./term.x"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# create hostsfile")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expr")]),s._v(" $SLURM_NPROCS / $SLURM_NNODES "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("b")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expr")]),s._v(" $SLURM_NPROCS % $SLURM_NNODES "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("yhcontrol show hostnames $SLURM_NODELIST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$b")]),s._v(" -ne "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("c")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expr")]),s._v(" $a + $b "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" hostsfile-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SLURM_JOBID")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("let")]),s._v(" b--\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" hostsfile-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SLURM_JOBID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# create cafconfig.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-genvall -genv I_MPI_FABRICS=shm:ofa -machinefile \n./hostsfile-'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SLURM_JOBID")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SLURM_NPROCS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXE")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cafconfig.txt\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# run  executable program ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXE")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[t("strong",[s._v("运行")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yhbatch sub.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("查询结果")])]),s._v(" "),t("p",[s._v("默认输出到一个名为"),t("code",[s._v("slurm-jobid.txt")]),s._v("的文件，其中"),t("code",[s._v("jobid")]),s._v("为一串数字。打开这个文件，正确内容为：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("img cannot "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n img          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" r   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.570796")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("简要说明：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("SBATCH")]),s._v(" 的三行，表示"),t("code",[s._v("-N")]),s._v("节点数，"),t("code",[s._v("-n")]),s._v(" 总核数，"),t("code",[s._v("-p")]),s._v(" 计算分区名（可以用"),t("code",[s._v("yhi")]),s._v("查看可用分区名）")]),s._v(" "),t("li",[t("code",[s._v('EXE="./term.x"')]),s._v(" 表示可执行程序的名字")]),s._v(" "),t("li",[s._v("接下来创建hostsfile，创建cafconfig.txt。这两步无需更改。")]),s._v(" "),t("li",[s._v("最后执行可执行程序。")])]),s._v(" "),t("h2",{attrs:{id:"附录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[s._v("#")]),s._v(" 附录")]),s._v(" "),t("p",[s._v("参考资料：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://software.intel.com/content/www/us/en/develop/articles/distributed-memory-coarray-fortran-with-the-intel-fortran-compiler-for-linux-essential.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Essential Guide to Distributed Memory Coarray Fortran with the Intel Fortran Compiler for Linux"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://bbs.fcode.cn/thread-2481-1-1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Fortran并行计算中OpenMP，MPI及Coarrays之单节点多线程应用比较"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://coarrays.sourceforge.io/doc.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Parallel programming with Fortran 2008 and 2018 coarrays"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://bbs.csdn.net/topics/360203456",target:"_blank",rel:"noopener noreferrer"}},[s._v("Co-Array Fortran 看上去很美 ？"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.dazhuanlan.com/2019/12/09/5dee05fd31a70/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PBS学习笔记"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);